import { Steps, Callout, Cards } from "nextra/components";

# First Coverage Data

> [!NOTE]
>
> Canyon provides [installation guides for common frameworks](/docs/installation/getting-started) to help you get started quickly.

Follow the steps below to complete your first coverage data report:

## Starting as a New Project

<Steps>
  ### Installation

In frontend engineering and modular development, Babel is essential. For Babel projects, you only need to install two Babel plugins to get started quickly.

```sh npm2yarn
npm install babel-plugin-istanbul babel-plugin-canyon -D
```

Add the [`istanbul`](https://www.npmjs.com/package/babel-plugin-istanbul) and [`canyon`](https://www.npmjs.com/package/babel-plugin-canyon) plugins to your [Babel configuration file](https://babeljs.io/docs/config-files#configuration-file-types):

  ```js filename="babel.config.js" {3,4} copy
  module.exports = {
    plugins: [
      'istanbul',
      'canyon'
      // Note the plugin order, canyon plugin should be after istanbul plugin
      ],
  };
  ```

### Verification

After configuration, start your project and print **window.\_\_coverage\_\_** in the console. If the output matches the image below, it means code instrumentation was successful.

![coverage-canyon-console](https://cdn.jsdelivr.net/gh/canyon-project/assets/docs/static/documentation/getting-started/first-coverage/coverage-canyon-console.png)

### Configure CI Environment Variables

In the CI environment, we need to configure some environment variables to report coverage data.

> [!TIP]
>
> Canyon detects pipeline variables at compile time, and we've adapted to multiple [pipeline providers](/docs/reference/provider).<br/>
> Don't see your pipeline provider? Try [explicit configuration](/docs/ecosystem/babel-plugin-canyon#configuration).

1. `DSN` and `REPORTER`

- **DSN**: The service address for reporting coverage data, \{\{url\}\}/coverage/client, where \{\{url\}\} is the Canyon service address.
- **REPORTER**: User token, which can be viewed in the Canyon user settings page.

2. Configure CI Platform Variables

![gitlab](https://cdn.jsdelivr.net/gh/canyon-project/assets/docs/static/documentation/getting-started/first-coverage/gitlab-var-config.png)

<Callout type="info" emoji="ℹ️">
  Project ID, branch, and SHA don't need to be configured manually. The Canyon plugin will automatically detect pipeline environment variables.
</Callout>

  ### Update Babel Plugin Activation Conditions

  __In the CI stage, we need to control the conditions for plugin activation to prevent instrumentation in production branches.__

  ```js {2,3} copy
  module.exports = {
    plugins: (process.env.CI &&
              process.env.CI_COMMIT_REF_NAME !== 'release')
              ? [
                'canyon',
                'istanbul'
              ]:[],
  };
  ```

  ### Report Coverage Data

  Wait for CI completion, then deploy the page to the test environment.

  At this point, coverage data is stored in the browser. As users interact or UI automation tests execute, the window.__coverage___ data will continuously accumulate.

  Accurately reporting this data to the Canyon server enables real-time display of coverage data.

  Here are several ways to report coverage data:

  <Cards>
  <Cards.Card
    title="UI Automation Testing"
    href="/docs/end-to-end-testing/playwright"
  />
  <Cards.Card
    title="Manual Testing"
    href="/docs/ecosystem/canyon-extension"
  />
</Cards>
</Steps> 