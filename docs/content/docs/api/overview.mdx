# API 概述

Canyon 提供 RESTful API 接口，用于上传和管理代码覆盖率数据。

## 基础 URL

所有 API 请求的基础路径为：

```
https://your-canyon-server.com/api
```

## 认证

部分 API 接口可能需要认证。如果接口需要认证，请在请求头中包含：

```
Authorization: Bearer <your-token>
```

## 数据格式

所有 API 请求和响应都使用 JSON 格式，请求头应包含：

```
Content-Type: application/json
```

## API 端点

### Coverage API

覆盖率相关的 API 端点：

- **[POST /coverage/map/init](/docs/api/coverage/map-init)** - 初始化覆盖率映射数据
- **[POST /coverage/client](/docs/api/coverage/client)** - 上传覆盖率数据

## 响应格式

API 响应通常遵循以下格式：

### 成功响应

```json
{
  "success": true,
  "buildHash": "abc123...",
  "sceneKey": "def456..."
}
```

### 错误响应

```json
{
  "success": false,
  "message": "错误描述信息"
}
```

## 状态码

- `200 OK` - 请求成功
- `400 Bad Request` - 请求参数错误
- `401 Unauthorized` - 未授权
- `404 Not Found` - 资源不存在
- `500 Internal Server Error` - 服务器内部错误

## 速率限制

API 请求可能受到速率限制。如果超过限制，将返回 `429 Too Many Requests` 状态码。

## 示例

### 使用 cURL

```bash
curl -X POST https://your-canyon-server.com/api/coverage/map/init \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your-token" \
  -d '{
    "sha": "abc123...",
    "provider": "github",
    "repoID": "owner/repo",
    "instrumentCwd": "/path/to/project",
    "coverage": {...}
  }'
```

### 使用 JavaScript (fetch)

```javascript
const response = await fetch('https://your-canyon-server.com/api/coverage/map/init', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer your-token'
  },
  body: JSON.stringify({
    sha: 'abc123...',
    provider: 'github',
    repoID: 'owner/repo',
    instrumentCwd: '/path/to/project',
    coverage: {...}
  })
});

const data = await response.json();
```

## 更多信息

- [Coverage Map Init API](/docs/api/coverage/map-init)
- [Coverage Client API](/docs/api/coverage/client)
