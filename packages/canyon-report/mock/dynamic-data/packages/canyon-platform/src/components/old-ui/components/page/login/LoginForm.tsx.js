window["packages/canyon-platform/src/components/old-ui/components/page/login/LoginForm.tsx"] = {"content":"import { useRequest } from \"ahooks\";\nimport { FC } from \"react\";\nconst onFinishFailed = (errorInfo: any) => {\n  console.log(\"Failed:\", errorInfo);\n};\n\ntype FieldType = {\n  companyname?: string;\n  username?: string;\n  password?: string;\n};\n\nconst LoginForm: FC<{\n  onLoginSuccess: () => void;\n}> = ({ onLoginSuccess }) => {\n  const { run } = useRequest(\n    ({ username, password, companyname }) =>\n      fetch(`/api/login`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          username: username,\n          password: password,\n          companyname: companyname,\n        }),\n      })\n        .then((res) => res.json())\n        .then((res) => {\n          if (res.statusCode >= 400) {\n            return Promise.reject(res);\n          } else {\n            return res;\n          }\n        }),\n    {\n      onSuccess: (data) => {\n        message.success(\"登录成功\");\n        onLoginSuccess();\n        localStorage.setItem(\"token\", data.token);\n      },\n      onError: (error) => {\n        console.log(error);\n        message.error(error.message);\n      },\n      manual: true,\n    },\n  );\n  const [form] = Form.useForm();\n  const onFinish = (values: any) => {\n    console.log(\"Success:\", values);\n    run({\n      companyname: String(values.companyname),\n      username: String(values.username),\n      password: String(values.password),\n    });\n  };\n  return (\n    <Form\n      form={form}\n      name=\"basic\"\n      layout={\"vertical\"}\n      className={\"flex-1 pr-5\"}\n      onFinish={onFinish}\n      onFinishFailed={onFinishFailed}\n    >\n      <Form.Item<FieldType>\n        label=\"Username\"\n        name=\"username\"\n        rules={[{ required: true, message: \"Please input your username!\" }]}\n      >\n        <Input placeholder={\"Username or Email\"} />\n      </Form.Item>\n\n      <Form.Item<FieldType>\n        label=\"Password\"\n        name=\"password\"\n        rules={[{ required: true, message: \"Please input your password!\" }]}\n      >\n        <Input.Password placeholder={\"Password\"} />\n      </Form.Item>\n\n      <Form.Item>\n        <Button type=\"primary\" htmlType=\"submit\">\n          Continue\n        </Button>\n      </Form.Item>\n    </Form>\n  );\n};\n\nexport default LoginForm;\n","coverage":{"name":"zt"}}