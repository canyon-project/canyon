window["packages/canyon-platform/src/components/CanyonReport/PrepareProdFn.tsx"] = {"content":"import React, { useState } from \"react\";\nimport { Alert, Button, Drawer } from \"antd\";\nimport { Editor } from \"@monaco-editor/react\";\nimport { useRequest } from \"ahooks\";\nimport axios from \"axios\";\n\nconst PrepareProdFn: React.FC = () => {\n  const [open, setOpen] = useState(false);\n  const prm = useParams();\n  const { data, loading, run } = useRequest(\n    () =>\n      axios\n        .post(\n          atob(`aHR0cHM6Ly90cmlwY2FueW9uLmZ3cy5xYS5udC5jdHJpcGNvcnAuY29t`) +\n            \"/api/coverage/prepareProdFn\",\n          {\n            projectID: prm.id,\n            sha: prm.sha,\n            username: localStorage.getItem(\"username\"),\n          },\n        )\n        .then(({ data }) => data),\n    {\n      manual: true,\n    },\n  );\n\n  const {\n    data: da1,\n    run: run1,\n    loading: loading1,\n  } = useRequest(\n    () =>\n      axios\n        .post(\n          atob(`aHR0cHM6Ly90cmlwY2FueW9uLmZ3cy5xYS5udC5jdHJpcGNvcnAuY29t`) +\n            \"/flytest-api-ctrip-coffeebean-transfer/api/task/triggerPullTrafficByFn\",\n          data,\n        )\n        .then(({ data }) => data),\n    {\n      manual: true,\n      onSuccess() {\n        message.success(\"开始转换，请留意后续Flybirds消息推送\");\n      },\n    },\n  );\n\n  const showDrawer = () => {\n    setOpen(true);\n  };\n\n  const onClose = () => {\n    setOpen(false);\n  };\n\n  useEffect(() => {\n    if (open) {\n      run();\n    }\n  }, [open]);\n\n  return (\n    <>\n      {[\n        \"tripgl-37885-auto\",\n        \"tripgl-62594-auto\",\n        // \"tripgl-108960-auto\",\n      ].includes(prm.id || \"\") && (\n        <Button type=\"primary\" onClick={showDrawer} size={\"small\"}>\n          转换生产流量为测试用例\n        </Button>\n      )}\n\n      <Drawer\n        title=\"转换生产流量为测试用例\"\n        onClose={onClose}\n        open={open}\n        destroyOnClose\n        width={\"75%\"}\n      >\n        <Spin spinning={loading}>\n          <Button type={\"primary\"} onClick={run1} loading={loading1}>\n            确认转换\n          </Button>\n          <div className={\"h-2\"} />\n          <Alert\n            message={\n              \"以下是拉取的Canyon测试未覆盖函数，MPASS生产已覆盖的流量数据\"\n            }\n          />\n          <div className={\"h-2\"} />\n          <Editor\n            language={\"json\"}\n            value={JSON.stringify(data || {}, null, 2)}\n            height={\"70vh\"}\n          />\n        </Spin>\n      </Drawer>\n    </>\n  );\n};\n\nexport default PrepareProdFn;\n","coverage":{"name":"zt"}}